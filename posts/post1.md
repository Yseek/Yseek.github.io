# 레거시 프로젝트 무한 재기동

회사에서 가장 오래된 프로젝트이다.

가볍고 빠르지만, 10년 가까이 말도 안되는 방식으로 서비스를 하고 있었다.

프로젝트의 간략한 스펙이다.
<br><br>

            1. Spring 프레임워크

            2. 빌드 툴을 사용하지 않고 프로젝트 내부에 lib 폴더에 스프링프레임워크을 갖고 있음.

            3. 자바 1.7

            4. Oracle 10g Enterprise Edition Release 10.2.0.1.0 

<br>

말도 안되는 방식의 서비스란...

*운영중에 서비스가 다운되면 바로 재기동으로 대응하는 것이었다.*

서비스가 다운되면 근무 중에는 물론 퇴근 이후 심지어 새벽에도 메일 알람이 1분 마다 오는 바람에 항상 신경을 쓸 수 밖에 없었다.

재빠르게 대응하다보니 자연스럽게 내가 담당하는 일이 되었고, 귀찮음과 이해할 수 없는 운영방식에 불만이 쌓여 원인을 찾아 해결하기로 마음을 먹었다.


---

### 원인 찾기

우선 Tomcat Manager 로 다운 됐을 때 상황을 보니 Thread 가 안 죽고 계속 쌓여 요청을 처리 할 수가 없는 상황이었다.

적절한 모니터링 툴을 사용하고 있지 않아. 원인 분석을 위해 VisualVM 설치 후 모니터링을 했다.

서비스가 다운 됐을 때, VisualVM 을 통해 쓰레드덤프을 받아 분석 결과

커넥션 객체에 Blocked 가 발생해 요청이 처리 되지 않고 Thread가 무한 생성 됐다.

---

### 해결 시도

1.우선, 커넥션 객체 반환 오류라 jdbc 관련 설정으로 해결시도 했다.

![images](../images/image.png)

효과가 전혀 없었다.




버전에 맞는 ojdbc 라이브러리, 
commons-pool 버전 호환

적절한 모니터링 툴을 사용하고 있지 않았음.

작성중...